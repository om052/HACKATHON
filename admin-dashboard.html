<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard | Smart Classroom</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif}
body{
  background:linear-gradient(135deg,#1e3c72,#2a5298);
  color:#fff;
}
.app{display:flex;min-height:100vh}

/* Sidebar */
.sidebar{
  width:240px;
  background:rgba(255,255,255,0.12);
  backdrop-filter:blur(16px);
  padding:25px;
}
.sidebar h2{margin-bottom:30px;font-size:1.3rem}
.sidebar a{
  display:block;
  padding:10px 14px;
  border-radius:12px;
  color:#fff;
  text-decoration:none;
  margin-bottom:10px;
  font-size:.9rem;
}
.sidebar a.active,.sidebar a:hover{
  background:rgba(255,255,255,0.2)
}

/* Main */
.main{flex:1;padding:25px 30px}

/* Topbar */
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:30px;
}
.role{
  background:#4facfe;
  color:#000;
  padding:4px 10px;
  border-radius:12px;
  font-size:.75rem;
}
.logout{
  background:#ff6b6b;
  border:none;
  padding:8px 16px;
  border-radius:20px;
  cursor:pointer;
}

/* Stats */
.stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:20px;
  margin-bottom:35px;
}
.card{
  background:rgba(255,255,255,0.15);
  backdrop-filter:blur(14px);
  padding:20px;
  border-radius:18px;
}
.card p{font-size:1.6rem;font-weight:600}

/* Section */
.section{
  background:rgba(255,255,255,0.12);
  backdrop-filter:blur(14px);
  padding:22px;
  border-radius:20px;
  margin-bottom:30px;
}
.section h3{margin-bottom:10px}
.section small{opacity:.8}

/* Attendance */
.attendance{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  margin-top:15px;
}
.teacher{
  padding:12px 16px;
  border-radius:14px;
  cursor:pointer;
  font-weight:600;
  min-width:80px;
  text-align:center;
}
.present{background:#4ade80;color:#000}
.absent{background:#f87171;color:#000}

/* Controls */
.controls{
  display:flex;
  gap:12px;
  margin:15px 0;
  flex-wrap:wrap;
}
select,button{
  padding:10px 14px;
  border-radius:12px;
  border:none;
  font-size:.85rem;
}
button{
  background:#43e97b;
  font-weight:600;
  cursor:pointer;
}

/* Timetable */
.table{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
  gap:14px;
}
.slot{
  background:rgba(255,255,255,0.18);
  padding:16px;
  border-radius:16px;
  text-align:center;
  font-size:.85rem;
}
.sub{
  background:#fde68a;
  color:#000;
  font-weight:700;
}

/* Requests */
.request{
  background:rgba(255,255,255,0.15);
  padding:16px;
  border-radius:16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}
.actions button{
  padding:6px 12px;
  border-radius:10px;
  margin-left:6px;
  font-size:.75rem;
}
.approve{background:#4ade80}
.reject{background:#f87171}
.empty{opacity:.8}
</style>
</head>

<body>
<div class="app">

<!-- Sidebar -->
<aside class="sidebar">
  <h2>Smart Classroom</h2>
  <a class="active">Dashboard</a>
  <a>Timetable</a>
  <a>Requests</a>
</aside>

<!-- Main -->
<main class="main">

<!-- Top -->
<div class="topbar">
  <h3 id="welcome"></h3>
  <button class="logout" onclick="logout()">Logout</button>
</div>

<!-- Stats -->
<div class="stats">
  <div class="card"><h4>Total Teachers</h4><p id="tCount">6</p></div>
  <div class="card"><h4>Total Students</h4><p>540</p></div>
  <div class="card"><h4>Pending Requests</h4><p id="reqCount">0</p></div>
</div>

<!-- Teacher Attendance -->
<div class="section">
  <h3>üë®‚Äçüè´ Teacher Attendance (Admin Only)</h3>
  <small>Toggle attendance. Used by Gemini AI to generate timetable.</small>
  <div class="attendance" id="attendance"></div>
</div>

<!-- AI Timetable -->
<div class="section">
  <h3>ü§ñ AI Timetable Generator</h3>
  <small>Powered by Google Gemini (Frontend Simulation)</small>

  <div class="controls">
    <select id="year">
      <option value="FE">First Year (FE)</option>
      <option value="SE">Second Year (SE)</option>
      <option value="TE">Third Year (TE)</option>
      <option value="BE">Final Year (BE)</option>
    </select>
    <button onclick="generateTimetable()">Generate with Gemini</button>
  </div>

  <div class="table" id="table"></div>
</div>

<!-- Requests -->
<div class="section">
  <h3>üì© Teacher Requests</h3>
  <div id="requests"></div>
</div>

</main>
</div>

<script>
/* SESSION */
const user = JSON.parse(localStorage.getItem("currentUser"));
if(!user || user.role!=="admin") location.href="index.html";
welcome.innerHTML = `Welcome, ${user.name} <span class="role">Admin</span>`;

/* CLEAN TEACHER POOL */
const DEFAULT_TEACHERS = [
  { id:"T1", status:"present" },
  { id:"T2", status:"present" },
  { id:"T3", status:"present" },
  { id:"T4", status:"present" },
  { id:"T5", status:"present" },
  { id:"T6", status:"present" }
];

let teachers = JSON.parse(localStorage.getItem("admin_teachers"));
if(!teachers || teachers.length < 4){
  teachers = DEFAULT_TEACHERS;
  localStorage.setItem("admin_teachers", JSON.stringify(teachers));
}

tCount.innerText = teachers.length;

/* Attendance */
function renderAttendance(){
  attendance.innerHTML="";
  teachers.forEach((t,i)=>{
    const d=document.createElement("div");
    d.className=`teacher ${t.status}`;
    d.innerText=t.id;
    d.onclick=()=>{
      teachers[i].status = t.status==="present"?"absent":"present";
      localStorage.setItem("admin_teachers",JSON.stringify(teachers));
      renderAttendance();
      generateTimetable();
    };
    attendance.appendChild(d);
  });
}

/* Subjects */
const subjects={
  FE:["Maths","Physics","Chemistry","English"],
  SE:["DSA","OOP","DBMS","Maths"],
  TE:["OS","CN","AI","SE"],
  BE:["Project","ML","Cloud","Elective"]
};

/* Gemini-style logic */
function generateTimetable(){
  table.innerHTML="";
  const available = teachers.filter(t=>t.status==="present");
  subjects[year.value].forEach((sub,i)=>{
    const div=document.createElement("div");
    if(available[i]){
      div.className="slot";
      div.innerHTML=`${sub}<br>${available[i].id}`;
    }else{
      div.className="slot sub";
      div.innerHTML=`${sub}<br>Substitute`;
    }
    table.appendChild(div);
  });
}

/* Requests */
let reqs = JSON.parse(localStorage.getItem("teacher_requests")) || [
  {text:"T2 requests leave (FE ‚Äì Maths)"},
  {text:"T5 requests swap (SE ‚Äì DSA)"}
];

function renderRequests(){
  requests.innerHTML="";
  if(!reqs.length){
    requests.innerHTML=`<p class="empty">No pending requests</p>`;
    reqCount.innerText=0;
    return;
  }
  reqs.forEach((r,i)=>{
    const d=document.createElement("div");
    d.className="request";
    d.innerHTML=`
      <span>${r.text}</span>
      <div class="actions">
        <button class="approve" onclick="handleReq(${i})">Approve</button>
        <button class="reject" onclick="handleReq(${i})">Reject</button>
      </div>`;
    requests.appendChild(d);
  });
  reqCount.innerText=reqs.length;
}
function handleReq(i){
  reqs.splice(i,1);
  renderRequests();
}

/* Logout */
function logout(){
  localStorage.removeItem("currentUser");
  location.href="index.html";
}

/* Init */
renderAttendance();
generateTimetable();
renderRequests();
</script>

</body>
</html>
