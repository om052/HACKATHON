<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard | Smart Classroom</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif}
body{background:linear-gradient(135deg,#1e3c72,#2a5298);color:#fff}
.app{display:flex;min-height:100vh}

/* Sidebar */
.sidebar{
  width:240px;
  background:rgba(255,255,255,0.12);
  backdrop-filter:blur(16px);
  padding:25px;
}
.sidebar h2{margin-bottom:30px}
.sidebar a{
  display:block;
  padding:10px 14px;
  border-radius:12px;
  color:#fff;
  text-decoration:none;
  margin-bottom:10px;
}
.sidebar a.active,.sidebar a:hover{
  background:rgba(255,255,255,0.2)
}

/* Main */
.main{flex:1;padding:25px 30px}

/* Topbar */
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:30px;
}
.role{
  background:#4facfe;
  color:#000;
  padding:4px 10px;
  border-radius:12px;
  font-size:.75rem;
}
.logout{
  background:#ff6b6b;
  border:none;
  padding:8px 16px;
  border-radius:20px;
  cursor:pointer;
}

/* Stats */
.stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:20px;
  margin-bottom:30px;
}
.card{
  background:rgba(255,255,255,0.15);
  padding:20px;
  border-radius:18px;
}
.card p{font-size:1.6rem;font-weight:600}

/* Sections */
.section{
  background:rgba(255,255,255,0.12);
  padding:22px;
  border-radius:20px;
  margin-bottom:30px;
}

/* Attendance */
.attendance{display:flex;gap:12px;flex-wrap:wrap;margin-top:15px}
.teacher{
  padding:12px 16px;
  border-radius:14px;
  cursor:pointer;
  font-weight:600;
}
.present{background:#4ade80;color:#000}
.absent{background:#f87171;color:#000}

/* Controls */
.controls{display:flex;gap:12px;margin:15px 0}
select,button{
  padding:10px 14px;
  border-radius:12px;
  border:none;
}
button{background:#43e97b;font-weight:600;cursor:pointer}

/* Timetable */
.table{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
  gap:14px;
}
.slot{
  background:rgba(255,255,255,0.18);
  padding:16px;
  border-radius:16px;
  text-align:center;
}
</style>
</head>

<body>
<div class="app">

<!-- SIDEBAR -->
<aside class="sidebar">
  <h2>Smart Classroom</h2>
  <a class="active">Dashboard</a>
</aside>

<!-- MAIN -->
<main class="main">

<div class="topbar">
  <h3 id="welcome"></h3>
  <button class="logout" onclick="logout()">Logout</button>
</div>

<div class="stats">
  <div class="card"><h4>Total Teachers</h4><p id="tCount"></p></div>
  <div class="card"><h4>Total Students</h4><p>540</p></div>
</div>

<div class="section">
  <h3>üë®‚Äçüè´ Teacher Attendance</h3>
  <small>Click to toggle availability</small>
  <div class="attendance" id="attendance"></div>
</div>

<div class="section">
  <h3>ü§ñ AI Timetable Generator</h3>

  <div class="controls">
    <select id="year">
      <option value="FE">First Year (FE)</option>
      <option value="SE">Second Year (SE)</option>
      <option value="TE">Third Year (TE)</option>
      <option value="BE">Final Year (BE)</option>
    </select>
    <button onclick="generateTimetable()">Generate & Publish</button>
  </div>

  <div class="table" id="table"></div>
</div>

</main>
</div>

<script>
/* AUTH */
const user = JSON.parse(localStorage.getItem("currentUser"));
if(!user || user.role!=="admin") location.href="index.html";
welcome.innerHTML = `Welcome, ${user.name} <span class="role">Admin</span>`;

/* TEACHERS */
const DEFAULT_TEACHERS=[
  {id:"T1",status:"present"},
  {id:"T2",status:"present"},
  {id:"T3",status:"present"},
  {id:"T4",status:"present"},
  {id:"T5",status:"present"},
  {id:"T6",status:"present"}
];

let teachers = JSON.parse(localStorage.getItem("admin_teachers")) || DEFAULT_TEACHERS;
localStorage.setItem("admin_teachers",JSON.stringify(teachers));
tCount.innerText = teachers.length;

function renderAttendance(){
  attendance.innerHTML="";
  teachers.forEach((t,i)=>{
    const d=document.createElement("div");
    d.className=`teacher ${t.status}`;
    d.innerText=t.id;
    d.onclick=()=>{
      teachers[i].status=t.status==="present"?"absent":"present";
      localStorage.setItem("admin_teachers",JSON.stringify(teachers));
      renderAttendance();
    };
    attendance.appendChild(d);
  });
}

/* SUBJECTS */
const subjects={
  FE:["Maths","Physics","Chemistry","English"],
  SE:["DSA","OOP","DBMS","Maths"],
  TE:["OS","CN","AI","SE"],
  BE:["Project","ML","Cloud","Elective"]
};

/* GENERATE + SAVE */
function generateTimetable(){
  table.innerHTML="";
  const yearVal=year.value;
  const available=teachers.filter(t=>t.status==="present");

  let timetableData=[];

  subjects[yearVal].forEach((sub,i)=>{
    let teacher=available[i]?available[i].id:"Substitute";
    const div=document.createElement("div");
    div.className="slot";
    div.innerHTML=`${sub}<br>${teacher}`;
    table.appendChild(div);

    timetableData.push({
      time:`Lecture ${i+1}`,
      subject:sub,
      teacher:teacher
    });
  });

  let all=JSON.parse(localStorage.getItem("timetable"))||{};
  all[yearVal]=timetableData;
  localStorage.setItem("timetable",JSON.stringify(all));

  alert("‚úÖ Timetable published for students");
}

/* LOGOUT */
function logout(){
  localStorage.removeItem("currentUser");
  location.href="index.html";
}

renderAttendance();
</script>
</body>
</html>
