<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard | Smart Classroom</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif}
body{background:linear-gradient(135deg,#1e3c72,#2a5298);color:#fff}
.app{display:flex;min-height:100vh}

/* Sidebar */
.sidebar{
  width:230px;background:rgba(255,255,255,0.12);
  backdrop-filter:blur(14px);padding:25px
}
.sidebar h2{margin-bottom:30px}
.sidebar a{
  display:block;padding:10px;border-radius:10px;
  color:#fff;text-decoration:none;margin-bottom:10px
}
.sidebar a.active,.sidebar a:hover{background:rgba(255,255,255,0.2)}

/* Main */
.main{flex:1;padding:25px}

/* Top */
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px}
.role{background:#4facfe;color:#000;padding:4px 10px;border-radius:12px;font-size:.75rem}
.logout{background:#ff6b6b;border:none;padding:8px 14px;border-radius:20px;cursor:pointer}

/* Stats */
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:20px;margin-bottom:30px}
.card{
  background:rgba(255,255,255,0.15);
  padding:18px;border-radius:16px
}
.card p{font-size:1.5rem;font-weight:600}

/* Section Card */
.section{
  background:rgba(255,255,255,0.12);
  backdrop-filter:blur(12px);
  padding:20px;border-radius:18px;
  margin-bottom:30px
}
.section h3{margin-bottom:10px}

/* Attendance */
.attendance{display:flex;gap:10px;flex-wrap:wrap}
.teacher{
  padding:10px 14px;border-radius:12px;
  cursor:pointer;min-width:70px;text-align:center;
  font-weight:600
}
.present{background:#4ade80;color:#000}
.absent{background:#f87171;color:#000}

/* Timetable */
.controls{display:flex;gap:10px;margin-bottom:15px}
select,button{padding:8px 12px;border-radius:10px;border:none}
button{background:#43e97b;font-weight:600;cursor:pointer}
.table{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px}
.slot{
  background:rgba(255,255,255,0.15);
  padding:14px;border-radius:12px;text-align:center
}
.sub{background:#fde68a;color:#000;font-weight:600}

/* Requests */
.request{
  background:rgba(255,255,255,0.15);
  padding:14px;border-radius:14px;
  display:flex;justify-content:space-between;
  align-items:center;margin-bottom:10px
}
.actions button{
  padding:6px 10px;border-radius:10px;
  margin-left:6px;font-size:.75rem
}
.approve{background:#4ade80}
.reject{background:#f87171}
.empty{opacity:.8}
</style>
</head>

<body>
<div class="app">

<!-- Sidebar -->
<aside class="sidebar">
  <h2>Smart Classroom</h2>
  <a class="active">Dashboard</a>
  <a>Timetable</a>
  <a>Requests</a>
</aside>

<!-- Main -->
<main class="main">

<div class="topbar">
  <h3 id="welcome"></h3>
  <button class="logout" onclick="logout()">Logout</button>
</div>

<div class="stats">
  <div class="card"><h4>Total Teachers</h4><p>4</p></div>
  <div class="card"><h4>Total Students</h4><p>540</p></div>
  <div class="card"><h4>Pending Requests</h4><p id="reqCount">0</p></div>
</div>

<!-- Teacher Attendance -->
<div class="section">
  <h3>üë®‚Äçüè´ Teacher Attendance (Admin Only)</h3>
  <p>System Teachers (T1 ‚Äì T4)</p><br>
  <div class="attendance" id="attendance"></div>
</div>

<!-- Timetable -->
<div class="section">
  <h3>ü§ñ AI Generated Timetable</h3>
  <div class="controls">
    <select id="year">
      <option value="FE">First Year</option>
      <option value="SE">Second Year</option>
      <option value="TE">Third Year</option>
      <option value="BE">Final Year</option>
    </select>
    <button onclick="generate()">Generate</button>
  </div>
  <div class="table" id="table"></div>
</div>

<!-- Teacher Requests -->
<div class="section">
  <h3>üì© Teacher Requests</h3>
  <div id="requests"></div>
</div>

</main>
</div>

<script>
/* SESSION */
const user = JSON.parse(localStorage.getItem("currentUser"));
if(!user || user.role!=="admin") location.href="index.html";
welcome.innerHTML=`Welcome, ${user.name} <span class="role">Admin</span>`;

/* TEACHERS */
const DEFAULT_TEACHERS=[
  {id:"T1",status:"present"},
  {id:"T2",status:"present"},
  {id:"T3",status:"present"},
  {id:"T4",status:"present"}
];
let adminTeachers=JSON.parse(localStorage.getItem("admin_teachers"))||DEFAULT_TEACHERS;
localStorage.setItem("admin_teachers",JSON.stringify(adminTeachers));

function renderAttendance(){
  attendance.innerHTML="";
  adminTeachers.forEach((t,i)=>{
    const d=document.createElement("div");
    d.className=`teacher ${t.status}`;
    d.innerText=t.id;
    d.onclick=()=>{
      adminTeachers[i].status=t.status==="present"?"absent":"present";
      localStorage.setItem("admin_teachers",JSON.stringify(adminTeachers));
      renderAttendance();generate();
    };
    attendance.appendChild(d);
  });
}

/* SUBJECTS */
const subjects={
  FE:["Maths","Physics","Chemistry","English"],
  SE:["DSA","OOP","DBMS","Maths"],
  TE:["OS","CN","AI","SE"],
  BE:["Project","ML","Cloud","Elective"]
};

function generate(){
  table.innerHTML="";
  const present=adminTeachers.filter(t=>t.status==="present");
  subjects[year.value].forEach((s,i)=>{
    const div=document.createElement("div");
    if(present[i]){
      div.className="slot";
      div.innerHTML=`${s}<br>${present[i].id}`;
    }else{
      div.className="slot sub";
      div.innerHTML=`${s}<br>Substitute`;
    }
    table.appendChild(div);
  });
}

/* REQUESTS */
let reqs=JSON.parse(localStorage.getItem("teacher_requests"))||[
  {text:"T2 requests leave (FE ‚Äì Maths)"},
  {text:"T3 requests swap (SE ‚Äì DSA)"}
];

function renderRequests(){
  requests.innerHTML="";
  if(!reqs.length){
    requests.innerHTML=`<p class="empty">No pending requests</p>`;
    reqCount.innerText=0;return;
  }
  reqs.forEach((r,i)=>{
    const d=document.createElement("div");
    d.className="request";
    d.innerHTML=`
      <span>${r.text}</span>
      <div class="actions">
        <button class="approve" onclick="handleReq(${i})">Approve</button>
        <button class="reject" onclick="handleReq(${i})">Reject</button>
      </div>`;
    requests.appendChild(d);
  });
  reqCount.innerText=reqs.length;
  localStorage.setItem("teacher_requests",JSON.stringify(reqs));
}
function handleReq(i){reqs.splice(i,1);renderRequests()}

/* LOGOUT */
function logout(){
  localStorage.removeItem("currentUser");
  location.href="index.html";
}

renderAttendance();
generate();
renderRequests();
</script>

</body>
</html>
